<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸ“Š Stock Live Monitor</title>

<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: #fff2e6;
    padding: 30px;
  }

  h1 {
    text-align: center;
    margin-bottom: 25px;
  }

  /* Add stock box */
  .add-box {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 25px;
  }

  input {
    padding: 10px 14px;
    width: 220px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
  }

  button {
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    background: #4f46e5;
    color: white;
    cursor: pointer;
    font-size: 15px;
  }

  button:hover {
    background: #4338ca;
  }

  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  }

  th, td {
    padding: 12px;
    text-align: center;
    border-bottom: 1px solid #eee;
    font-size: 14px;
  }

  th {
    background: #1f2937;
    color: white;
  }

  tr:hover {
    background: #f9fafb;
  }

  .dot {
    height: 14px;
    width: 14px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
  }

  #info {
    margin-top: 15px;
    text-align: center;
    color: #555;
    font-size: 14px;
  }
</style>
</head>

<body>

<h1>ðŸ“ˆ Stock Live Monitor</h1>

<!-- Add stock -->
<div class="add-box">
  <input id="tickerInput" placeholder="ICICIBANK.NS" />
  <button onclick="addStock()">Add Stock</button>
</div>

<!-- Table -->
<table>
  <thead>
    <tr>
      <th>Stock</th>
      <th>10:30 High</th>
      <th>10:30 Low</th>
      <th>Current Price</th>
      <th>Status</th>
      <th>Current High</th>
      <th>Current Low</th>
    </tr>
  </thead>
  <tbody id="stockBody"></tbody>
</table>

<div id="info">Loading...</div>

<script>
/* ===============================
   CONFIG
================================ */
const BACKEND = "https://stock-analysis-module.onrender.com";

/* ===============================
   Helpers
================================ */
function fmt(x) {
  if (x === null || x === undefined) return "â€”";
  return Number(x).toFixed(2);
}

/* ===============================
   Add Stock
================================ */
async function addStock() {
  const inp = document.getElementById("tickerInput");
  let ticker = inp.value.trim().toUpperCase();
  if (!ticker) return;

  await fetch(`${BACKEND}/add_stock/${ticker}`, { method: "POST" });
  inp.value = "";
  fetchStatus();
}

/* ===============================
   Load Status
================================ */
async function fetchStatus() {
  try {
    const res = await fetch(`${BACKEND}/status`);
    const data = await res.json();

    const tbody = document.getElementById("stockBody");
    tbody.innerHTML = "";

    const colors = {
      AMBER: "orange",
      RED: "red",
      UNKNOWN: "gray",
      MARKET_CLOSED: "black"
    };

    for (const [name, s] of Object.entries(data.stocks)) {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td><strong>${name}</strong></td>
        <td>${fmt(s.open_high)}</td>
        <td>${fmt(s.open_low)}</td>
        <td>${fmt(s.last_price)}</td>
        <td>
          <span class="dot" style="background:${colors[s.status] || "gray"}"></span>
          ${s.status}
        </td>
        <td>${fmt(s.current_high)}</td>
        <td>${fmt(s.current_low)}</td>
      `;
      tbody.appendChild(row);
    }

    document.getElementById("info").innerText =
      "Last updated: " + data.time;

  } catch (e) {
    console.error(e);
    document.getElementById("info").innerText = "Backend not reachable";
  }
}

/* ===============================
   Auto refresh
================================ */
fetchStatus();
setInterval(fetchStatus, 3000);
</script>

</body>
</html>